<!DOCTYPE html>
<html lang="en">

<head>
    <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
    <meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <meta HTTP-EQUIV="expires" CONTENT="0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="layui/css/layui.css" media="all">
    <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
    <title>日志自动下载</title>
</head>


<body>
    <div class="layui-main ">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;"> </fieldset>
        <fieldset class=" layui-elem-field">
            <legend>使用流程</legend>
            <div class="layui-field-box">
                上报处获取日志流程
            </div>
            <div class="layui-field-box">
                &nbsp&nbsp&nbsp 在上报错误网页里找到日志下载链接 -> 地址栏输入链接 -> 等待下载
            </div>
            <div class="layui-field-box">
                其他获取日志流程：
            </div>
            <div class="layui-field-box">
                &nbsp&nbsp&nbsp 控制台打印命令`TestUtil.getLogDownloadInfo()`获取日志下载信息 -> 复制日志下载信息 -> 网页下点击下载按钮 -> 等待下载
            </div>
            <div class="layui-field-box">
                &nbsp&nbsp&nbsp 控制台打印命令`TestUtil.getLogDownloadUrl()`获取日志下载链接 -> 地址栏输入链接 -> 等待下载
            </div>
        </fieldset>

        <div class="layui-row">
            <div class="layui-col-md6 layui-col-md-offset0">
                <button class="layui-btn" id="download" style="margin-top: 20px;">下载</button>
            </div>
        </div>

        <fieldset class=" layui-elem-field">
            <legend>控制台</legend>
            <div id='logView' class="layui-field-box">
            </div>
        </fieldset>

    </div>
    <script type='module'>
        window.onerror = function (errorMessage, scriptURI, lineNumber, columnNumber, error) {
            console.log(errorMessage);
        };

    </script>

    <el-table :data="tableData" :resizable="false" border style="width: 100%">
        <template v-for="(item, index) in config.tableHeaders">
            <el-table-column :key="index" :prop="item.key" :label="item.label" header-align="center">
            </el-table-column>
        </template>
    </el-table>



    <script type="text/javascript" src="config.js"></script>
    <script type="text/javascript" src="download.js"></script>
    <script type="text/javascript" src="autoDownLoad.js"></script>

    <script type='module'>
        window.onerror = function (errorMessage, scriptURI, lineNumber, columnNumber, error) {
            console.log(errorMessage);
        };
        window.onload = () => {
            let logView = document.getElementById('logView');
            function refreshLog(tContent, tDetail = "") {
                logView.innerHTML = `<span style="color:#ed1941;">${tContent}</span>` + `<span style="color:#2468a2;">${tDetail}</span>`;
            }
            setDownloadProgressCB(refreshLog);

            const url = new URL(location.href);
            const base64 = url.searchParams.get('str');
            base64 && downloadByBase64(base64);
        }
    </script>

</body>


</html>